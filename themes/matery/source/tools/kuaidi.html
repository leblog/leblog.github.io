<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快递费计算工具（自动累计）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        neutral: '#64748B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
            .btn-hover {
                @apply hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200;
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .slide-in {
                animation: slideIn 0.3s ease-out;
            }
            @keyframes slideIn {
                from { opacity: 0; transform: translateX(-10px); }
                to { opacity: 1; transform: translateX(0); }
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 页面标题 -->
        <header class="text-center mb-10">
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-gray-800 mb-2">
                <i class="fa fa-truck text-primary mr-3"></i>快递费计算工具
            </h1>
            <p class="text-neutral text-lg">自动累计功能：计算后自动加入总和</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧：计算表单 -->
            <div class="lg:col-span-2 space-y-6">
                <!-- 计算卡片 -->
                <div class="bg-white rounded-xl p-6 md:p-8 card-shadow">
                    <form id="calculator-form" class="space-y-6">
                        <!-- 重量输入 -->
                        <div class="form-group">
                            <label for="weight" class="block text-gray-700 font-medium mb-2">
                                <i class="fa fa-balance-scale text-primary mr-2"></i>货物重量 (kg)
                            </label>
                            <div class="relative">
                                <input 
                                    type="number" 
                                    id="weight" 
                                    step="0.1" 
                                    min="0.1" 
                                    required
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition duration-200"
                                    placeholder="例如：2.5"
                                >
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="text-gray-500">kg</span>
                                </div>
                            </div>
                        </div>

                        <!-- 首重价格 -->
                        <div class="form-group">
                            <label for="firstWeightPrice" class="block text-gray-700 font-medium mb-2">
                                <i class="fa fa-tag text-primary mr-2"></i>首重价格 (元)
                            </label>
                            <div class="relative">
                                <input 
                                    type="number" 
                                    id="firstWeightPrice" 
                                    step="0.01" 
                                    min="0.01" 
                                    required
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition duration-200"
                                    placeholder="首重1kg的价格，例如：12.00"
                                >
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="text-gray-500">元</span>
                                </div>
                            </div>
                        </div>

                        <!-- 续重价格 -->
                        <div class="form-group">
                            <label for="additionalWeightPrice" class="block text-gray-700 font-medium mb-2">
                                <i class="fa fa-tags text-primary mr-2"></i>续重价格 (元/kg)
                            </label>
                            <div class="relative">
                                <input 
                                    type="number" 
                                    id="additionalWeightPrice" 
                                    step="0.01" 
                                    min="0.01" 
                                    required
                                    class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition duration-200"
                                    placeholder="超过1kg后，每公斤的价格，例如：8.00"
                                >
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="text-gray-500">元/kg</span>
                                </div>
                            </div>
                        </div>

                        <!-- 按钮组 -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-2">
                            <button 
                                type="submit" 
                                class="flex-1 bg-primary text-white font-medium py-3 px-6 rounded-lg flex items-center justify-center btn-hover"
                            >
                                <i class="fa fa-calculator mr-2"></i>计算并累计
                            </button>
                            <button 
                                type="reset" 
                                class="flex-1 bg-gray-200 text-gray-700 font-medium py-3 px-6 rounded-lg flex items-center justify-center btn-hover"
                            >
                                <i class="fa fa-refresh mr-2"></i>重置
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 单次计算结果 -->
                <div id="single-result" class="hidden bg-white rounded-xl p-6 md:p-8 card-shadow border-l-4 border-secondary fade-in">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-check-circle text-secondary mr-2"></i>计算结果
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-gray-600 text-sm mb-1">本次费用</p>
                            <p id="singleFee" class="text-3xl font-bold text-secondary">¥0.00</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-gray-600 text-sm mb-1">计费重量</p>
                            <p id="singleWeight" class="text-2xl font-bold text-gray-800">0.0 kg</p>
                        </div>
                    </div>
                    <div class="mt-3 text-green-600 text-sm flex items-center">
                        <i class="fa fa-check-circle mr-1"></i>
                        <span>已自动加入累计</span>
                    </div>
                </div>
            </div>

            <!-- 右侧：累计区域 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 累计结果卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-calculator text-primary mr-2"></i>累计费用
                    </h2>

                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p class="text-gray-600 text-sm mb-1">累计总费用</p>
                        <p id="totalSum" class="text-3xl font-bold text-accent">¥0.00</p>
                    </div>

                    <div class="mb-4">
                        <p class="text-gray-600 text-sm mb-2">
                            <i class="fa fa-list-alt text-gray-400 mr-1"></i>已累计 <span id="itemCount">0</span> 个快递
                        </p>
                        <div id="itemsList" class="max-h-60 overflow-y-auto text-sm space-y-2">
                            <p class="text-gray-400 italic text-center py-4">暂无累计记录</p>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button id="calculate-total" class="flex-1 bg-secondary text-white font-medium py-2 px-4 rounded-lg flex items-center justify-center btn-hover" disabled>
                            <i class="fa fa-sum mr-1"></i>查看总和
                        </button>
                        <button id="clear-total" class="flex-1 bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg flex items-center justify-center btn-hover" disabled>
                            <i class="fa fa-trash mr-1"></i>清空
                        </button>
                    </div>
                </div>

                <!-- 使用说明 -->
                <div class="bg-white rounded-xl p-6 card-shadow text-sm text-gray-600">
                    <h3 class="font-bold text-gray-800 mb-2 flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2"></i>使用说明
                    </h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>计算快递费后会自动加入累计</li>
                        <li>可连续添加多个快递费用</li>
                        <li>点击"查看总和"可查看累计结果</li>
                        <li>点击"清空"可重置累计记录</li>
                        <li>首重1kg内固定价，续重不足1kg按1kg计</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 总和结果弹窗 -->
        <div id="total-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                    <i class="fa fa-calculator text-accent mr-2"></i>累计运费总和
                </h3>
                <div class="text-center mb-6">
                    <p class="text-gray-600 mb-2">共 <span id="modal-count" class="font-bold">0</span> 个快递</p>
                    <p id="modal-total" class="text-4xl font-bold text-accent">¥0.00</p>
                </div>
                <button id="close-modal" class="w-full bg-primary text-white font-medium py-3 px-6 rounded-lg flex items-center justify-center btn-hover">
                    <i class="fa fa-check mr-2"></i>确认
                </button>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="mt-10 text-center text-gray-500 text-sm">

        </footer>
    </div>

    <script>
        // 全局变量存储累计数据
        let accumulatedItems = [];

        // 获取DOM元素
        const form = document.getElementById('calculator-form');
        const weightInput = document.getElementById('weight');
        const firstWeightPriceInput = document.getElementById('firstWeightPrice');
        const additionalWeightPriceInput = document.getElementById('additionalWeightPrice');
        const singleResultDiv = document.getElementById('single-result');
        const singleFeeElement = document.getElementById('singleFee');
        const singleWeightElement = document.getElementById('singleWeight');
        const calculateTotalBtn = document.getElementById('calculate-total');
        const clearTotalBtn = document.getElementById('clear-total');
        const totalSumElement = document.getElementById('totalSum');
        const itemCountElement = document.getElementById('itemCount');
        const itemsListElement = document.getElementById('itemsList');
        const totalModal = document.getElementById('total-modal');
        const modalTotalElement = document.getElementById('modal-total');
        const modalCountElement = document.getElementById('modal-count');
        const closeModalBtn = document.getElementById('close-modal');

        // 表单提交事件 - 计算并自动累计
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            calculateAndAccumulate();
        });

        // 计算总和按钮事件
        calculateTotalBtn.addEventListener('click', function() {
            if (accumulatedItems.length === 0) return;

            // 计算总和
            const total = accumulatedItems.reduce((sum, item) => sum + item.fee, 0);

            // 更新弹窗内容
            modalTotalElement.textContent = `¥${total.toFixed(2)}`;
            modalCountElement.textContent = accumulatedItems.length;

            // 显示弹窗
            totalModal.classList.remove('hidden');
        });

        // 清空累计按钮事件
        clearTotalBtn.addEventListener('click', function() {
            if (confirm('确定要清空所有累计记录吗?')) {
                accumulatedItems = [];
                updateAccumulatedDisplay();
            }
        });

        // 关闭弹窗按钮事件
        closeModalBtn.addEventListener('click', function() {
            totalModal.classList.add('hidden');
        });

        // 点击弹窗外部关闭弹窗
        totalModal.addEventListener('click', function(e) {
            if (e.target === totalModal) {
                totalModal.classList.add('hidden');
            }
        });

        // 重置按钮事件
        form.addEventListener('reset', function() {
            singleResultDiv.classList.add('hidden');
            weightInput.focus();
        });

        // 输入框回车键触发计算
        const inputFields = [weightInput, firstWeightPriceInput, additionalWeightPriceInput];
        inputFields.forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    calculateAndAccumulate();
                }
            });
        });

        // 计算快递费并自动加入累计
        function calculateAndAccumulate() {
            // 获取输入值并转换为数值
            const weight = parseFloat(weightInput.value);
            const firstWeightPrice = parseFloat(firstWeightPriceInput.value);
            const additionalWeightPrice = parseFloat(additionalWeightPriceInput.value);

            // 验证输入
            if (isNaN(weight) || isNaN(firstWeightPrice) || isNaN(additionalWeightPrice)) {
                alert('请输入有效的数字');
                return;
            }

            let totalFee, billingWeight;

            // 计算费用
            if (weight <= 1) {
                // 不超过首重
                totalFee = firstWeightPrice;
                billingWeight = 1;
            } else {
                // 超过首重，计算续重
                const additionalWeight = weight - 1;
                // 向上取整，不足1kg按1kg计算
                const roundedAdditionalWeight = Math.ceil(additionalWeight);
                billingWeight = 1 + roundedAdditionalWeight;

                totalFee = firstWeightPrice + (roundedAdditionalWeight * additionalWeightPrice);
            }

            // 四舍五入保留两位小数
            totalFee = Math.round(totalFee * 100) / 100;

            // 显示单次计算结果
            singleFeeElement.textContent = `¥${totalFee.toFixed(2)}`;
            singleWeightElement.textContent = `${billingWeight} kg`;
            singleResultDiv.classList.remove('hidden');

            // 自动加入累计
            accumulatedItems.push({
                fee: totalFee,
                weight: weight,
                billingWeight: billingWeight,
                timestamp: new Date()
            });

            // 更新累计显示
            updateAccumulatedDisplay();

            // 添加新加入的项目动画效果
            const lastItem = itemsListElement.lastChild;
            if (lastItem && accumulatedItems.length > 0) {
                lastItem.classList.add('slide-in');
            }

            // 平滑滚动到结果区域
            singleResultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 更新累计显示
        function updateAccumulatedDisplay() {
            // 计算总和
            const total = accumulatedItems.reduce((sum, item) => sum + item.fee, 0);

            // 更新显示
            totalSumElement.textContent = `¥${total.toFixed(2)}`;
            itemCountElement.textContent = accumulatedItems.length;

            // 更新列表
            itemsListElement.innerHTML = '';
            if (accumulatedItems.length === 0) {
                itemsListElement.innerHTML = '<p class="text-gray-400 italic text-center py-4">暂无累计记录</p>';
                calculateTotalBtn.disabled = true;
                clearTotalBtn.disabled = true;
            } else {
                accumulatedItems.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center p-2 border-b border-gray-100 last:border-0';
                    itemElement.innerHTML = `
                        <div>
                            <span class="font-medium">快递 #${index + 1}</span>
                            <span class="text-gray-500 ml-2">${item.billingWeight}kg</span>
                        </div>
                        <span class="font-bold text-secondary">¥${item.fee.toFixed(2)}</span>
                    `;
                    itemsListElement.appendChild(itemElement);
                });

                calculateTotalBtn.disabled = false;
                clearTotalBtn.disabled = false;
            }
        }

        // 设置默认值以便快速测试
        weightInput.value = '2.5';
        firstWeightPriceInput.value = '12';
        additionalWeightPriceInput.value = '8';

        // 初始化累计显示
        updateAccumulatedDisplay();
    </script>
</body>
</html>